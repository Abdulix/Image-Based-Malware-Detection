from django.shortcuts import render

# Create your views here.
# views.py
from django.http import JsonResponse
from django.views import View
from .utils import convert_to_grayscale_image, resize_image
from .models import make_prediction
from tensorflow.keras.models import load_model

class MakePredictionView(View):
    def post(self, request):
        try:
            if request.FILES and 'file' in request.FILES:
                uploaded_file = request.FILES['file']
                binary_data = uploaded_file.read()

                img = convert_to_grayscale_image(binary_data)
                img = resize_image(img, (224, 224))

                model = load_model('F:\FINAL YEAR PROJECT\TRAINED MODEL\model_vgg16.h5')
                prediction = make_prediction(model, img)

                response_data = {'predictions': prediction}
                return JsonResponse(response_data, status=200)
            else:
                return JsonResponse({'error': 'File not provided.'}, status=400)
        except Exception as e:
            return JsonResponse({'error': f"An error occurred: {str(e)}"}, status=500)

    def get(self, request):
        return JsonResponse({'message': 'Welcome to the prediction API!'})
